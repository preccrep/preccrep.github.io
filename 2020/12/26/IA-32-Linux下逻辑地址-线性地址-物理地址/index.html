<!DOCTYPE html><html lang="en"><head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="preconnect" href="//www.googletagmanager.com">
	<link rel="preconnect" href="//zz.bdstatic.com">
	<link rel="preconnect" href="//sp0.baidu.com">
	<link rel="preconnect" href="//www.google-analytics.com">
	<link rel="preconnect" href="//cdn1.lncld.net">
	<link rel="preconnect" href="//unpkg.com">
	<link rel="preconnect" href="//app-router.leancloud.cn">
	<link rel="preconnect" href="//9qpuwspm.api.lncld.net">
	<link rel="preconnect" href="//gravatar.loli.net">

	<title>IA-32/Linux下逻辑地址-线性地址-物理地址 | Serial</title>

	<meta name="HandheldFriendly" content="True">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
	<meta name="generator" content="hexo">
	<meta name="author" content="preccrep">
	<meta name="description" content="">

	
	<meta name="keywords" content="">
	

	
	<link rel="shortcut icon" href="https://i.loli.net/2021/07/05/Yf2EJr7egbH4sSc.png">
	<link rel="apple-touch-icon" href="https://i.loli.net/2021/07/05/Yf2EJr7egbH4sSc.png">
	

	
	<meta name="theme-color" content="#3c484e">
	<meta name="msapplication-TileColor" content="#3c484e">
	

	

	

	<meta property="og:site_name" content="Serial">
	<meta property="og:type" content="article">
	<meta property="og:title" content="IA-32/Linux下逻辑地址-线性地址-物理地址 | Serial">
	<meta property="og:description" content="">
	<meta property="og:url" content="https://preccrep.github.io/2020/12/26/IA-32-Linux%E4%B8%8B%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80-%E7%BA%BF%E6%80%A7%E5%9C%B0%E5%9D%80-%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80/">

	
	<meta property="article:published_time" content="2020-12-26T11:12:00+08:00"> 
	<meta property="article:author" content="preccrep">
	<meta property="article:published_first" content="Serial, /2020/12/26/IA-32-Linux%E4%B8%8B%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80-%E7%BA%BF%E6%80%A7%E5%9C%B0%E5%9D%80-%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80/">
	

	
	
	
<link rel="stylesheet" href="/css/allinonecss.min.css">


	
	
	
<link rel="alternate" href="/atom.xml" title="Serial" type="application/atom+xml">
</head>

<body class="post-template">
	<div class="site-wrapper">
		




<header class="site-header post-site-header outer">
    <div class="inner">
        
<nav class="site-nav"> 
    <div class="site-nav-left">
        <ul class="nav">
            <li>
                
                
                <a class="site-nav-logo" href="/" title="Serial">
                    <img src="今日事，今日毕" alt="Serial">
                </a>
                
                
            </li>
            
            
            <li>
                <a href="/about" title="ABOUT">ABOUT</a>
            </li>
            
            <li>
                <a href="/archives" title="ARCHIVES">ARCHIVES</a>
            </li>
            
            
        </ul> 
    </div>
    
    <div class="search-button-area">
        <a href="#search" class="search-button">Search ...</a>
    </div>
     
    <div class="site-nav-right">
        
        <a href="#search" class="search-button">Search ...</a>
         
        
<div class="social-links">
    
    
    <a class="social-link" title="github" href="https://github.com/preccrep" target="_blank" rel="noopener">
        <svg viewBox="0 0 1049 1024" xmlns="http://www.w3.org/2000/svg"><path d="M524.979332 0C234.676191 0 0 234.676191 0 524.979332c0 232.068678 150.366597 428.501342 358.967656 498.035028 26.075132 5.215026 35.636014-11.299224 35.636014-25.205961 0-12.168395-0.869171-53.888607-0.869171-97.347161-146.020741 31.290159-176.441729-62.580318-176.441729-62.580318-23.467619-60.841976-58.234462-76.487055-58.234463-76.487055-47.804409-32.15933 3.476684-32.15933 3.476685-32.15933 53.019436 3.476684 80.83291 53.888607 80.83291 53.888607 46.935238 79.963739 122.553122 57.365291 152.97411 43.458554 4.345855-33.897672 18.252593-57.365291 33.028501-70.402857-116.468925-12.168395-239.022047-57.365291-239.022047-259.012982 0-57.365291 20.860106-104.300529 53.888607-140.805715-5.215026-13.037566-23.467619-66.926173 5.215027-139.067372 0 0 44.327725-13.906737 144.282399 53.888607 41.720212-11.299224 86.917108-17.383422 131.244833-17.383422s89.524621 6.084198 131.244833 17.383422C756.178839 203.386032 800.506564 217.29277 800.506564 217.29277c28.682646 72.1412 10.430053 126.029806 5.215026 139.067372 33.897672 36.505185 53.888607 83.440424 53.888607 140.805715 0 201.64769-122.553122 245.975415-239.891218 259.012982 19.121764 16.514251 35.636014 47.804409 35.636015 97.347161 0 70.402857-0.869171 126.898978-0.869172 144.282399 0 13.906737 9.560882 30.420988 35.636015 25.205961 208.601059-69.533686 358.967656-265.96635 358.967655-498.035028C1049.958663 234.676191 814.413301 0 524.979332 0z"></path></svg>
    </a>
    
    
    
    <a class="social-link" title="twitter" href="https://preccrep.com" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path></svg>

    </a>
    
    
    
    
</div>
    </div>
</nav>
    </div>
</header>


<div id="site-main" class="site-main outer" role="main">
    <div class="inner">
        <header class="post-full-header">
            <div class="post-full-meta">
                <time class="post-full-meta-date" datetime="2020-12-26T03:02:29.000Z">
                    2020-12-26
                </time>
                
                <span class="date-divider">/</span>
                
                <a href="/categories/NEMU/">NEMU</a>&nbsp;&nbsp;
                
                
            </div>
            <h1 class="post-full-title">IA-32/Linux下逻辑地址-线性地址-物理地址</h1>
        </header>
        <div class="post-full no-image">
            
            <div class="post-full-content">
                <article id="photoswipe" class="markdown-body">
                    <p>CPU内部的存储器就是寄存器</p>
<p>分层存储器存在的意义：让存储器又快又大</p>
<p>存储器越靠近CPU速度越大，容量越小</p>
<p>局部性原理达到分层的效果</p>
<p>英特尔32位架构（英语：Intel Architecture, 32-bit，缩写为IA-32），常被称为i386、或x86，由英特尔公司于1985年推出的指令集架构。它是8086架构的延伸版本，可支持32位运算，首次应用在Intel 80386芯片中。</p>
<p>IA-32架构属于复杂指令集，由英特尔公司开发，1985年，随着Intel 80386的上市，被公之于世。接下来20年的时间，虽然后继的新型芯片运算速度不断增加，但IA-32架构大体上都没有改变。对许多编程语言来说，IA-32与i386是同义词。</p>
<p>英特尔也是世界上最大的IA-32芯片供应商，AMD则是第二大的供应商。2011年，英特尔与AMD同时采用了新的x86-64架构，但是x86架构仍然被应用在如Intel Atom（N2xx与Z5xx系列）、AMD Geode等芯片上。威盛电子生产的VIA C3/C7，也仍然采用IA-32架构。</p>
<p>IA-32微处理器支持实模式和保护模式。</p>
<p><strong>实模式</strong></p>
<p>相当于高性能的16位8086微处理器，但进行了功能扩充，能够使用8086所没有的寻址方式和32位通用寄存器以及大部分指令。不具有保护机制，不能使用部分特权指令。实模式下只有20条地址线有效，存储空间为1MB。</p>
<p><strong>保护模式</strong></p>
<p>充分发挥IA-32微处理器的存储管理功能和硬件支持的保护机制，为多任务操作系统设计提供支持。该模式下每个任务的存储空间为4GB。</p>
<p>在保护模式下还具有一种子模式——虚拟8086模式（V86模式），可以在保护模式的多任务环境中以类似实模式的方式运行16位8086软件。</p>
<p>按字节编址（通用计算机大都是）</p>
<p>在<strong>保护模式</strong>下，IA-32采用<strong>段页式虚拟存储</strong>管理方式</p>
<p>逻辑地址和线性地址是虚拟地址，是编程用的地址；描述的都是4GB虚拟地址空间中的一个存储地址。</p>
<p>物理地址是访问存储器的地址，是真实地址。</p>
<blockquote>
<p>逻辑地址：48位，包含16位段选择符和32位段内偏移量（即<strong>有效地址</strong>）</p>
<p>线性地址：32位（其位数由虚拟地址空间大小决定）</p>
<blockquote>
<p>32位处理器，所以虚拟成32位</p>
</blockquote>
<p>物理地址：32位（其位数由存储器总线中的地址线条数决定）</p>
<blockquote>
<p>对于物理地址：（实际的不知道）假设就是32位，那外面的物理存储器可能就是4GB(2^32B=4GB)</p>
</blockquote>
</blockquote>
<p><strong><em>分段过程实现   逻辑地址 —&gt; 线性地址</em></strong></p>
<p><strong><em>分页过程实现    线性地址—&gt;物理地址</em></strong></p>
<h1 id="逻辑地址到线性地址（分段）"><a href="#逻辑地址到线性地址（分段）" class="headerlink" title="逻辑地址到线性地址（分段）"></a>逻辑地址到线性地址（分段）</h1><p><em>8086处理器的所有内部寄存器都是16位（AX, BX, CX, DX, SP, BP, SI, <strong>CS</strong>, <strong>DS</strong>）</em></p>
<p>（CS、DS是段寄存器）</p>
<p><em>8086处理器支持的存储器寻址方式有哪些？</em></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">寻址方式</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">位移</td>
<td style="text-align:center">EA = A</td>
</tr>
<tr>
<td style="text-align:center">基址寻址</td>
<td style="text-align:center">EA = (B)</td>
</tr>
<tr>
<td style="text-align:center">基址加位移</td>
<td style="text-align:center">EA = (B) + A</td>
</tr>
<tr>
<td style="text-align:center">比例变址加位移</td>
<td style="text-align:center">EA = (I) * S + A</td>
</tr>
<tr>
<td style="text-align:center">基址加变址加位移</td>
<td style="text-align:center">EA = (B) + (I) + A</td>
</tr>
<tr>
<td style="text-align:center">基址加比例变址加位移</td>
<td style="text-align:center">EA = (B) + (I) * S + A</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>A — 地址段偏移量</p>
<p>B — 基址寄存器</p>
<p>I — 变址寄存器（除SP）</p>
<p>S — 比例因子</p>
<p>EA — 有效地址</p>
</blockquote>
<p>8086指令（AT&amp;T格式）举例：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">movw 8(%bp, %dx, 4), %ax   //R[ax] &lt;-- M[R[bp] + R[dx]*4 + 8]</span><br></pre></td></tr></tbody></table></figure>
<p>此时的寻址空间是 2^16B = 64KB，太小了！</p>
<p>于是8086引入段寄存器开辟更大的寻址空间：</p>
<blockquote>
<p>16位段寄存器（CS, SS, DS, ES等）</p>
<p>物理访存地址 = (段寄存器 &lt;&lt; 4) + 有效地址</p>
</blockquote>
<p>于是寻址空间变为 1MB了（2^16&lt;&lt; 4 B = 2^20 B = 1MB）</p>
<p>此时的物理地址称为<strong>线性地址</strong>。</p>
<p>于是就变成了：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">寻址方式</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">位移</td>
<td style="text-align:center">LA = (SR &lt;&lt; 4) + A</td>
</tr>
<tr>
<td style="text-align:center">基址寻址</td>
<td style="text-align:center">LA = (SR &lt;&lt; 4) + (B)</td>
</tr>
<tr>
<td style="text-align:center">基址加位移</td>
<td style="text-align:center">LA = (SR &lt;&lt; 4) + (B) + A</td>
</tr>
<tr>
<td style="text-align:center">比例变址加位移</td>
<td style="text-align:center">LA = (SR &lt;&lt; 4) + (I) * S + A</td>
</tr>
<tr>
<td style="text-align:center">基址加变址加位移</td>
<td style="text-align:center">LA = (SR &lt;&lt; 4) + (B) + (I) + A</td>
</tr>
<tr>
<td style="text-align:center">基址加比例变址加位移</td>
<td style="text-align:center">LA = (SR &lt;&lt; 4) + (B) + (I) * S + A</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">movw [ds:8(%bp, %dx, 4)], %ax   //R[ax] &lt;-- M[R[ds]&lt;&lt;4 + R[bp] + R[dx]*4 + 8]</span><br></pre></td></tr></tbody></table></figure>
<p>访问数据段就是和DS绑定的，访问代码段就是和CS绑定的。取指令要用到CS和IP，访问堆栈用到SS，等等。</p>
<p>物理访存地址 = (段寄存器 &lt;&lt; 4) + 有效地址—<strong>这个访问模式称为实模式！</strong></p>
<h2 id="实模式"><a href="#实模式" class="headerlink" title="实模式"></a>实模式</h2><p>8086处理器在实模式下工作：</p>
<blockquote>
<p>物理地址直接访存</p>
<p>可访问 1MB 主存空间</p>
<p>需要20根地址线（2^20，因为加上了(SR&gt;&gt;4)）</p>
<p>每次访存必须和某个段寄存器绑定</p>
</blockquote>
<p>存在的问题：</p>
<blockquote>
<p>寻址空间有限</p>
<p>存在安全隐患</p>
</blockquote>
<p>IA-32，即80386，标志着32位计算机的时代到来。</p>
<p>所有通用寄存器都是32位，寻址空间达到4GB！</p>
<p>正式支持虚拟存储器的概念，采用虚拟地址访存。</p>
<blockquote>
<p>寻址空间已经达到4GB，是否可以去掉段寄存器？</p>
<p>不能。考虑兼容性！</p>
</blockquote>
<p>于是IA-32处理器支持两种工作模式：</p>
<blockquote>
<p>实模式：IA-32处理器加电或复位时处于这一模式，此时相当于8086/8088处理器，32位地址线中的A31~A20不起作用，所有访存地址都是物理地址（实地址）。</p>
<p>保护模式：完成系统初始化后，进入该模式，此时32位地址线全部起作用，访存地址为逻辑地址（虚拟地址），进入虚拟存储器管理方式。</p>
</blockquote>
<h2 id="保护模式"><a href="#保护模式" class="headerlink" title="保护模式"></a>保护模式</h2><p>IA-32有一个”开关”，决定处理器处于哪种模式下：</p>
<p>CR0寄存器与通用寄存器不同，是另外一种寄存器。它叫控制状态寄存器。</p>
<blockquote>
<p>对实模式和保护模式来说看哪一位呢？</p>
<p><strong>最后一位。（第0位，即PE位）</strong></p>
</blockquote>
<p>计算机加电或复位时，PE = 0，IA-32处理器处于实模式。</p>
<p>PE = 1时，处于保护模式，并且一旦进入保护模式就不能再切换回到实模式了，除非…重启（重新开机复位）。</p>
<p>（所以只能从实模式进保护模式）</p>
<p><em>为什么IA-32分段机制更复杂？</em></p>
<blockquote>
<p>与历史遗留问题有关：</p>
<p>寻址空间有限，仅1MB.</p>
<p>存在安全隐患。</p>
<p>段大小固定(64KB(2^16 B))</p>
<p>不灵活，无法设置访问权限。</p>
<p>……</p>
</blockquote>
<p>进入IA-32时代，我们希望段地址也是32位的，还可以灵活设置各种段属性，但段寄存器只有16位，连32位段基址也放不下，怎么办？</p>
<h3 id="段描述符"><a href="#段描述符" class="headerlink" title="段描述符"></a>段描述符</h3><p><strong>段描述符</strong>是用来描述一个段所有属性的数据结构。</p>
<p>每个段对应一个段描述符。</p>
<p><img alt="image-20201225173007530" class="post-img b-lazy" data-img="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20201225173007530.png" data-index="0" data-src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20201225173007530.png"></p>
<p>一个段描述符占8个字节（64位），包括：</p>
<p>B31~B0：32位基地址</p>
<p>L19~L0：20位限界，表示段的大小</p>
<p>G：粒度。G = 1以页（4KB）为单位，G = 0以字节为单位。因为界限为20位，故当G = 0时最大的段为1MB；当G = 1时，最大段为4KB*2^20=4GB。</p>
<p>D：D = 1表示段内偏移量为32位宽，D = 0表示段内偏移量为16位宽。</p>
<p>P：present. P = 1表示段在主存里，P = 0表示段不在主存里。Linux总把P置1，不会以段为单位淘汰，因为Linux以页为单位。</p>
<p>S：S = 0表示系统控制描述符，S = 1表示普通的代码段或数据段描述符。</p>
<p>TYPE：段的访问权限或系统控制描述符类型。</p>
<p>A：A = 1表示已被访问过，A = 0表示未被访问过（TYPE一般是4位，A是其中的1位）</p>
<p>DPL：权限位。</p>
<h3 id="段描述符的组织"><a href="#段描述符的组织" class="headerlink" title="段描述符的组织"></a><strong>段描述符的组织</strong></h3><blockquote>
<p>（Q represents question, P represents preccrep）</p>
<p>Q：<em>段描述符占64位，段寄存器才16位，根本放不下，怎么办？</em></p>
<p>P：放到主存中。</p>
<p>Q：<em>可是怎么在主存中找到一个段描述符？</em></p>
<p>P：利用指针。</p>
<p>Q：<em>IA-32中涉及到地址的，还是32位。所以段描述符的地址也一定是32位的，段寄存器放不下，只能放到主存里。IA-32中的指针也是32位的，段寄存器还是放不下；即使能放下，如果想切换到其他段，怎么知道段描述符在什么地方？</em></p>
<p>P：把所有的段描述符组织成一个数组啊。</p>
<p>Q：<em>？</em></p>
<p>P：段描述符只是一个数据结构，一旦找到段描述符，就能把段的基地址读出来，然后就能访问到相应的段了，问题就解决了。所以关键是怎么找到段描述符。没错，段描述符的地址一定是32位地址，因为它们是放在主存里的。在IA-32里，我们把所有段描述符都组成一个数组，数组索引用16位总能放下吧！用数组索引访问！就是——</p>
</blockquote>
<p>IA-32把内存中的某一连续空间解释成一个数组，称为<strong>段描述符表</strong>，简称<strong>段表</strong>。数组中每个元素对应一个段描述符。</p>
<p>段表由OS负责填写。包括3种类型：</p>
<blockquote>
<p>全局描述符表(GDT)：只有一个，是所有进程共享的，用来保存系统中每个任务都可以访问的段描述符，如内核代码段、数据段，用户代码段、数据段等。</p>
<p>局部描述符表(LDT)：存放某一用户进程专用的描述符（其他用户进程是访问不到的），但LDT不是一个独立的段表，它就保存在GDT中，甚至可以看作是GDT里的一个段描述符。</p>
<p>中断描述符表(IDT)：独立于GDT的段表，包含中断门、陷阱门等描述符。例如系统调用的函数入口地址就要从IDT中获取。</p>
</blockquote>
<p>GDT的首地址由<strong>全局描述符表寄存器（GDTR）</strong>提供。</p>
<p>GDTR这个寄存器<strong>只存放</strong>GDT的入口地址！</p>
<p>还有，段表不是一个大数组吗，我们是通过数组索引找到所需的描述符的，而该索引不就保存在段寄存器中吗，它称为<strong>段选择符</strong>。</p>
<h3 id="GDTR"><a href="#GDTR" class="headerlink" title="GDTR"></a><strong>GDTR</strong></h3><p>GDTR的结构长这样：</p>
<p>BASE ADDR(基地址)    |   LIMIT(限界)</p>
<p>32-bit                            |   16-bit</p>
<p>高32位存放GDT的入口地址，低16位存放GDT的大小。</p>
<p>当然，GDTR最大也就64位。这里是48位。</p>
<blockquote>
<p>Q：<em>GDTR中保存的地址是线性地址，为什么不是逻辑地址？</em></p>
<p>P：我们分段机制用它(GDTR)不就是为了把逻辑地址变为线性地址吗。要是GDTR中也是逻辑地址，那这个首地址(GDT的首地址)谁来给它变？</p>
</blockquote>
<p><strong>GDTR对用户进程不可见</strong>，只有OS才能访问。仅可由OS内核通过一条特权指令(lgdt m16&amp;32)将GDT的首地址和限界装载到GDTR中，启动分段机制。</p>
<h3 id="段选择符和段寄存器"><a href="#段选择符和段寄存器" class="headerlink" title="段选择符和段寄存器"></a><strong>段选择符和段寄存器</strong></h3><blockquote>
<p>CS(代码段)：程序代码所在段</p>
<p>SS(栈段)：栈区所在段</p>
<p>DS(数据段)：全局静态数据区所在段</p>
<p>其他3个段寄存器ES、GS和FS可指向任意数据段</p>
</blockquote>
<h3 id="段选择符各字段含义"><a href="#段选择符各字段含义" class="headerlink" title="段选择符各字段含义"></a><strong>段选择符各字段含义</strong></h3><p>15   14 … 3  |  2   |  1   0</p>
<p> INDEX         |  TI  |  RPL</p>
<p>TI = 0，选择GDT；TI = 1，选择LDT。</p>
<p>RPL请求特权级。</p>
<p><strong>高13位索引</strong>用来确定当前使用的段描述符在描述表中的位置。</p>
<p>——&gt; <strong>由此可知，GDT中最多可容纳 2^13=8192=8K 个段描述符。</strong></p>
<p>那么整个段表多大？（1个段描述符占8个字节）</p>
<p>8K*8 B = 64KB.</p>
<p>而段寄存器是16位，2^16 = 64K个字节——刚好相等呀！</p>
<p>没错，16位就是这么来的。</p>
<p>于是，回归正题，逻辑地址怎么变到线性地址？</p>
<p>先看TI位。若TI = 0，那就先从GDTR里把GDT首地址读出来，然后加上索引——注意，是索引乘上8！乘上字节的宽度！基地址+索引*8.</p>
<p>GDT和IDT只有一个，GDTR和IDTR指向各自起始处。</p>
<p>LDTR  16-bit</p>
<p>GDTR, IDTR  48-bit</p>
<p>每次段寄存器装入新选择符时，新描述符装入描述符cache，在逻辑地址到线性地址转换时，MMU直接用描述符cache中的信息，不必访问主存段表</p>
<p>LDTR存放LDT描述符的段选择符</p>
<p>LDT描述符在GDT中</p>
<p><img alt="image-20201225200258987" class="post-img b-lazy" data-img="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20201225200258987.png" data-index="1" data-src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20201225200258987.png"></p>
<p>总之，逻辑地址转线性地址的过程就是这样：</p>
<ol>
<li>逻辑地址高16位是段选择符，低32位是段内偏移。</li>
<li>通过段寄存器中的段选择符TI位决定在哪个表中查找。</li>
<li>根据GDTR读出段描述符表的首地址。</li>
<li>根据段寄存器中的段选择符index位在表中进行索引，找到一个段描述符。</li>
<li>在段描述符中读出段的基地址，和逻辑地址相加，得到线性地址。</li>
</ol>
<p>在计算线性地址的过程中，可根据段描述符中的限界和访问权限判断是否“地址越界”或“访问越权”，以实现存储保护。</p>
<blockquote>
<p>Q：<em>索引 为什么乘以8？</em></p>
<p>P：1个段描述符占8个字节。</p>
<p>Q：<em>被选中的段描述符存放在什么地方？</em></p>
<p>P：描述符cache里。</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><ol>
<li>逻辑地址起作用的<strong>前提</strong>：CR0的PE位为1，进入保护模式，启动分段机制。</li>
<li>根据<strong>段寄存器中的段选择符</strong>的TI位决定查GDT还是LDT</li>
<li>在GDTR中读出GDT首地址</li>
<li>GDT首地址+段选择符中索引*8 — 得到段描述符首地址</li>
<li>在段描述符中读出段基址，和有效地址（逻辑地址后32位，即段内偏移）相加，得到线性地址</li>
</ol>
<p>注意那个前提——否则实模式下有效地址就是线性地址，段寄存器也就用来左移4位加上有效地址得到物理地址了。</p>
<h1 id="IA-32-Linux中的存储保护"><a href="#IA-32-Linux中的存储保护" class="headerlink" title="IA-32/Linux中的存储保护"></a>IA-32/Linux中的存储保护</h1><h2 id="IA-32的权限检查（基于环保护机制）"><a href="#IA-32的权限检查（基于环保护机制）" class="headerlink" title="IA-32的权限检查（基于环保护机制）"></a>IA-32的权限检查（基于环保护机制）</h2><p>DPL：位于段描述符中，表示一个段所在的特权级别。例如，DPL为3说明该段可能是一个用户段，为0可能是内核段。</p>
<p>RPL：位于段选择符中，表示请求者所在的特权级别。</p>
<p>CPL：表示当前进程的特权级别，一般与CS寄存器指向的段描述符的DPL字段相同。</p>
<p>同时满足以下两个条件：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">target_descriptor.DPL &gt;= requestor.RPL   <span class="comment">//请求者有权访问目标段</span></span><br><span class="line">target_descriptor.DPL &gt;= CPL             <span class="comment">//当前进程有权访问目标段</span></span><br></pre></td></tr></tbody></table></figure>
<p>只要OS将GDT、页表等重要信息放在ring0段中，恶意程序将永远无法篡改它们，除非恶意程序获得了OS权限。</p>
<h2 id="IA-32-Linux中的分段机制"><a href="#IA-32-Linux中的分段机制" class="headerlink" title="IA-32/Linux中的分段机制"></a>IA-32/Linux中的分段机制</h2><p>为能被移植到绝大多数流行处理器平台，Linux简化了分段机制。</p>
<p>RISC对分段支持非常有限，因此<strong>Linux仅使用IA-32的分页机制</strong>，而对于分段，则通过<strong>在初始化时将所有段描述符的基址设为”0”来简化</strong>。</p>
<p>每个段都被初始化在 0~4GB 的线性地址空间中。</p>
<p>PA2中的用户程序都是从 <code>kernel/src/start.S</code> 开始的。PA3也是如此。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">#include "common.h"</span><br><span class="line"></span><br><span class="line">#ifndef IA32_SEG</span><br><span class="line"></span><br><span class="line">	.globl start</span><br><span class="line">	start:</span><br><span class="line">	# Set up a stack for C code.</span><br><span class="line">		movl $0, %ebp</span><br><span class="line">		movl $(128 &lt;&lt; 20), %esp</span><br><span class="line">		jmp init				# never return</span><br><span class="line"></span><br><span class="line">#else</span><br><span class="line"></span><br><span class="line">	# To understand macros here, see i386 manual.</span><br><span class="line">	#define GDT_ENTRY(n) ((n) &lt;&lt; 3)</span><br><span class="line"></span><br><span class="line">	#define MAKE_NULL_SEG_DESC   \</span><br><span class="line">		.word 0, 0;              \</span><br><span class="line">		.byte 0, 0, 0, 0</span><br><span class="line"></span><br><span class="line">	# The 0xC0 means the limit is in 4096-byte units</span><br><span class="line">	# and (for executable segments) 32-bit mode.</span><br><span class="line">	#define MAKE_SEG_DESC(type,base,lim)                        \</span><br><span class="line">		.word (((lim) &gt;&gt; 12) &amp; 0xffff), ((base) &amp; 0xffff);      \</span><br><span class="line">		.byte (((base) &gt;&gt; 16) &amp; 0xff), (0x90 | (type)),         \</span><br><span class="line">		(0xC0 | (((lim) &gt;&gt; 28) &amp; 0xf)), (((base) &gt;&gt; 24) &amp; 0xff)</span><br><span class="line"></span><br><span class="line">	#ifdef IA32_PAGE</span><br><span class="line">	#	define KOFFSET 0xc0000000</span><br><span class="line">	#	define va_to_pa(x) (x - KOFFSET)</span><br><span class="line">	#else</span><br><span class="line">	#	define va_to_pa(x) (x)</span><br><span class="line">	#endif</span><br><span class="line"></span><br><span class="line">	.globl start</span><br><span class="line">	start:</span><br><span class="line">		lgdt    va_to_pa(gdtdesc) # See i386 manual for more information</span><br><span class="line">		movl    %cr0, %eax        # %CR0 |= PROTECT_ENABLE_BIT</span><br><span class="line">		orl     $0x1, %eax</span><br><span class="line">		movl    %eax, %cr0</span><br><span class="line"></span><br><span class="line">	# Complete transition to 32-bit protected mode by using long jmp</span><br><span class="line">	# to reload %CS and %EIP.  The segment descriptors are set up with no</span><br><span class="line">	# translation, so that the mapping is still the identity mapping.</span><br><span class="line">		ljmp    $GDT_ENTRY(1), $va_to_pa(start_cond)</span><br><span class="line"></span><br><span class="line">	start_cond:</span><br><span class="line">	# Set up the protected-mode data segment registers</span><br><span class="line">		movw    $GDT_ENTRY(2), %ax</span><br><span class="line">		movw    %ax, %ds          # %DS = %AX</span><br><span class="line">		movw    %ax, %es          # %ES = %AX</span><br><span class="line">		movw    %ax, %ss          # %SS = %AX</span><br><span class="line"></span><br><span class="line">	# Set up a stack for C code.</span><br><span class="line">		movl $0, %ebp</span><br><span class="line">		movl $(128 &lt;&lt; 20), %esp</span><br><span class="line">		jmp init				# never return</span><br><span class="line"></span><br><span class="line">	# GDT</span><br><span class="line">	.p2align 2                    # force 4 byte alignment</span><br><span class="line">	gdt:</span><br><span class="line">		MAKE_NULL_SEG_DESC                   # empty segment</span><br><span class="line">		MAKE_SEG_DESC(0xA, 0x0, 0xffffffff)  # code</span><br><span class="line">		MAKE_SEG_DESC(0x2, 0x0, 0xffffffff)  # data</span><br><span class="line"></span><br><span class="line">	gdtdesc:                      # descriptor</span><br><span class="line">		.word   (gdtdesc - gdt - 1)    # limit = sizeof(gdt) - 1</span><br><span class="line">		.long   va_to_pa(gdt)          # address of GDT</span><br><span class="line"></span><br><span class="line"># end of IA32_SEG</span><br><span class="line">#endif</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>现在来逐段分析：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#ifndef IA32_SEG</span><br></pre></td></tr></tbody></table></figure>
<p>这个是分段的宏，PA2里没考虑分段，也就没用到，所以直接跳到内核里去了。但是在PA3中，这个宏就要起作用了。在 <code>kernel/include/common.h</code> 中设置，把 <code>define IA32_SEG</code> 前的注释符号去掉。</p>
<blockquote>
<p>除了 <code>#define</code> 中的 <code>#</code> 外，其他的 <code>#</code> 都是注释！</p>
</blockquote>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.globl start</span><br><span class="line">	start:</span><br><span class="line">	# Set up a stack for C code.</span><br><span class="line">		movl $0, %ebp</span><br><span class="line">		movl $(128 &lt;&lt; 20), %esp</span><br><span class="line">		jmp init				# never return</span><br></pre></td></tr></tbody></table></figure>
<p>PA2没用分段（即没用 IA32_SEG 宏，not define，满足 <code>#ifndef</code>），就执行上面的部分；</p>
<p>PA3用了分段，就执行 <code>#else</code> 的部分.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#define MAKE_NULL_SEG_DESC   \</span><br><span class="line">		.word 0, 0;              \</span><br><span class="line">		.byte 0, 0, 0, 0</span><br></pre></td></tr></tbody></table></figure>
<p>这个宏是将 <code>MAKE_NULL_SEG_DESC</code> 替换为下面那两个东西…</p>
<p><code>.word</code> 和 <code>.byte</code> 就是汇编里的声明数据。声明为 <code>.word</code> 就是说那两个0都是 <code>.word</code> 类型，也就是16位宽，所以这里声明了两个16位的0。<code>.byte</code> 声明的是字节，相当于C语言中的 <code>char</code> 类型。2个16位的加上4个8位的，一共就是8个字节。所以——</p>
<p>这就是一个段描述符！只不过这是一个空的段描述符，因为都是0.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#define MAKE_SEG_DESC(type,base,lim)                        \</span><br><span class="line">		.word (((lim) &gt;&gt; 12) &amp; 0xffff), ((base) &amp; 0xffff);      \</span><br><span class="line">		.byte (((base) &gt;&gt; 16) &amp; 0xff), (0x90 | (type)),         \</span><br><span class="line">		(0xC0 | (((lim) &gt;&gt; 28) &amp; 0xf)), (((base) &gt;&gt; 24) &amp; 0xff)</span><br></pre></td></tr></tbody></table></figure>
<p>这个宏还带参数的啊—— <code>type</code> ，<code>base</code> ，<code>lim</code> ——这不就是段描述符里的信息吗？</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ifdef IA32_PAGE</span><br><span class="line">	#	define KOFFSET 0xc0000000</span><br><span class="line">	#	define va_to_pa(x) (x - KOFFSET)</span><br><span class="line">	#else</span><br><span class="line">	#	define va_to_pa(x) (x)</span><br><span class="line">	#endif</span><br></pre></td></tr></tbody></table></figure>
<p>定没定义PAGE，自己决定用哪个函数。</p>
<p>最核心的部分：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.globl start</span><br><span class="line">	start:</span><br><span class="line">		lgdt    va_to_pa(gdtdesc) # See i386 manual for more information</span><br><span class="line">		movl    %cr0, %eax        # %CR0 |= PROTECT_ENABLE_BIT</span><br><span class="line">		orl     $0x1, %eax</span><br><span class="line">		movl    %eax, %cr0</span><br></pre></td></tr></tbody></table></figure>
<p>再来看这个——<code>lgdt</code> ，将全局描述符表的首地址和大小加载到了GDTR里。这里 <code>va_to_pa</code> 只有1个参数 <code>gdtdesc</code> ，这是一个地址，而由 <code>#define va_to_pa(x) (x)</code> 得知，这不就是 <code>gdtdesc</code> 本身吗。那这到底是什么东西呢，看下面：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gdtdesc:                      # descriptor</span><br><span class="line">		.word   (gdtdesc - gdt - 1)    # limit = sizeof(gdt) - 1</span><br><span class="line">		.long   va_to_pa(gdt)          # address of GDT</span><br></pre></td></tr></tbody></table></figure>
<p>嗯，不就是把 <code>gdtdesc</code> 里面的 <code>.word</code> 和 <code>.long</code> 加载过去吗？ <code>.word</code> 是16位的， <code>.long</code> 是32位的。它们是什么注释里都写清楚了，要强调的是 <code>gdtdesc - gdt - 1</code> 的这个减一。</p>
<p>当然，再看看这个 <code>gdtdesc</code> ，不就刚好是48位吗？没错，<code>lgdt</code> 就是把48位的逻辑地址加载到GDTR中去。</p>
<p>继续看start的代码。先把CR0的值放到EAX里，然后EAX与1进行OR，再把得到的值放回CR0。我们分析一下，当 “CR0最低位” = 0时，这一番操作使得 “CR0最低位” = 1，这就是实模式 —&gt; 保护模式。</p>
<h1 id="线性地址到物理地址（分页）"><a href="#线性地址到物理地址（分页）" class="headerlink" title="线性地址到物理地址（分页）"></a>线性地址到物理地址（分页）</h1><h2 id="IA-32中的控制寄存器"><a href="#IA-32中的控制寄存器" class="headerlink" title="IA-32中的控制寄存器"></a>IA-32中的控制寄存器</h2><p>控制寄存器保存机器的各种控制和状态信息，操作系统进行任务控制或存储管理时使用控制寄存器。</p>
<p><strong>CR0</strong>：PG位：</p>
<p>1 - 启用分页</p>
<p>0 - 禁止分页，此时线性地址被直接作为物理地址使用。</p>
<p>若启用分页机制，PE和PG位都要置1.</p>
<p><strong>CR2</strong>：页故（page fault）障线性地址寄存器</p>
<p>当要访问的页不在主存里时，触发了缺页中断，中断处的线性地址保存在CR2里，等到页面被调入后再继续从这里开始执行。</p>
<p><strong>CR3</strong>：页目录基址寄存器</p>
<p>保存页目录表的起始地址。</p>
<p>当然，CR2和CR3有效的前提都是PG = 1。</p>
<p>Linux中线性地址空间划分：4GB = 1K个子空间 <em> 1K个页面/子空间 </em> 4KB/页</p>
<p><img alt="image-20201226101431856" class="post-img b-lazy" data-img="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20201226101431856.png" data-index="2" data-src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20201226101431856.png"></p>
<p>每一个页表就是一个子空间，页表中有1K项，每一项对应一个物理页；</p>
<p>页目录表只有1张，里面有1K个页目录项，每一项对应一个页表。</p>
<blockquote>
<p>每1K个页面用一个页表进行组织，每个页表有1K个项，每项对应一个物理页（页框）</p>
<p>线性地址由3个字段组成，分别是10位页目录索引，10位页表索引，12位页内偏移</p>
</blockquote>
<p>CR3中存放的就是页目录表的基地址，拿到基地址后加上DIR*4（为什么乘以4？因为一个页目录项是32位，即4字节），得到相应页表项的首地址。再加上PAGE*4，得到物理页的首地址。物理页首地址再加上页内偏移量，就是真正的物理地址。</p>
<h2 id="页目录项和页表项的格式"><a href="#页目录项和页表项的格式" class="headerlink" title="页目录项和页表项的格式"></a>页目录项和页表项的格式</h2><p><img alt="image-20201226105427190" class="post-img b-lazy" data-img="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20201226105427190.png" data-index="3" data-src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20201226105427190.png"></p>
<p>CPU发出地址先送到MMU，MMU完成分段和分页再送到cache。MMU中的分段解决逻辑地址到物理地址的变换，分页解决线性地址到物理地址的变换。</p>

                </article>
                <ul class="tags-postTags">
                    
                    <li>
                        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" rel="tag"># 计算机组成原理</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>

    
    <nav id="gobottom" class="pagination">
        
        <a class="prev-post" title="旋转数组" href="/2021/01/08/%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84/">
            ← 旋转数组
        </a>
        
        <span class="prev-next-post">·</span>
        
        <a class="next-post" title="分治算法" href="/2020/12/23/%E5%88%86%E6%B2%BB%E7%AE%97%E6%B3%95/">
            分治算法 →
        </a>
        
    </nav>

    
    <div class="inner">
        <div id="comment"></div>
    </div>
    
</div>

<div class="toc-bar">
    <div class="toc-btn-bar">
        <a href="#site-main" class="toc-btn">
            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M793.024 710.272a32 32 0 1 0 45.952-44.544l-310.304-320a32 32 0 0 0-46.4 0.48l-297.696 320a32 32 0 0 0 46.848 43.584l274.752-295.328 286.848 295.808z"></path></svg>
        </a>
        <div class="toc-btn toc-switch">
            <svg class="toc-open" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M779.776 480h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M779.776 672h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M256 288a32 32 0 1 0 0 64 32 32 0 0 0 0-64M392.576 352h387.2a32 32 0 0 0 0-64h-387.2a32 32 0 0 0 0 64M256 480a32 32 0 1 0 0 64 32 32 0 0 0 0-64M256 672a32 32 0 1 0 0 64 32 32 0 0 0 0-64"></path></svg>
            <svg class="toc-close hide" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M512 960c-247.039484 0-448-200.960516-448-448S264.960516 64 512 64 960 264.960516 960 512 759.039484 960 512 960zM512 128.287273c-211.584464 0-383.712727 172.128262-383.712727 383.712727 0 211.551781 172.128262 383.712727 383.712727 383.712727 211.551781 0 383.712727-172.159226 383.712727-383.712727C895.712727 300.415536 723.551781 128.287273 512 128.287273z"></path><path d="M557.05545 513.376159l138.367639-136.864185c12.576374-12.416396 12.672705-32.671738 0.25631-45.248112s-32.704421-12.672705-45.248112-0.25631l-138.560301 137.024163-136.447897-136.864185c-12.512727-12.512727-32.735385-12.576374-45.248112-0.063647-12.512727 12.480043-12.54369 32.735385-0.063647 45.248112l136.255235 136.671523-137.376804 135.904314c-12.576374 12.447359-12.672705 32.671738-0.25631 45.248112 6.271845 6.335493 14.496116 9.504099 22.751351 9.504099 8.12794 0 16.25588-3.103239 22.496761-9.247789l137.567746-136.064292 138.687596 139.136568c6.240882 6.271845 14.432469 9.407768 22.65674 9.407768 8.191587 0 16.352211-3.135923 22.591372-9.34412 12.512727-12.480043 12.54369-32.704421 0.063647-45.248112L557.05545 513.376159z"></path></svg>
        </div>
        <a href="#gobottom" class="toc-btn">
            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M231.424 346.208a32 32 0 0 0-46.848 43.584l297.696 320a32 32 0 0 0 46.4 0.48l310.304-320a32 32 0 1 0-45.952-44.544l-286.848 295.808-274.752-295.36z"></path></svg>
        </a>
    </div>
    <div class="toc-main">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80%E5%88%B0%E7%BA%BF%E6%80%A7%E5%9C%B0%E5%9D%80%EF%BC%88%E5%88%86%E6%AE%B5%EF%BC%89"><span class="toc-text">逻辑地址到线性地址（分段）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%A8%A1%E5%BC%8F"><span class="toc-text">实模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">保护模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AE%B5%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">段描述符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AE%B5%E6%8F%8F%E8%BF%B0%E7%AC%A6%E7%9A%84%E7%BB%84%E7%BB%87"><span class="toc-text">段描述符的组织</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GDTR"><span class="toc-text">GDTR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AE%B5%E9%80%89%E6%8B%A9%E7%AC%A6%E5%92%8C%E6%AE%B5%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">段选择符和段寄存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AE%B5%E9%80%89%E6%8B%A9%E7%AC%A6%E5%90%84%E5%AD%97%E6%AE%B5%E5%90%AB%E4%B9%89"><span class="toc-text">段选择符各字段含义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IA-32-Linux%E4%B8%AD%E7%9A%84%E5%AD%98%E5%82%A8%E4%BF%9D%E6%8A%A4"><span class="toc-text">IA-32/Linux中的存储保护</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IA-32%E7%9A%84%E6%9D%83%E9%99%90%E6%A3%80%E6%9F%A5%EF%BC%88%E5%9F%BA%E4%BA%8E%E7%8E%AF%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6%EF%BC%89"><span class="toc-text">IA-32的权限检查（基于环保护机制）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IA-32-Linux%E4%B8%AD%E7%9A%84%E5%88%86%E6%AE%B5%E6%9C%BA%E5%88%B6"><span class="toc-text">IA-32/Linux中的分段机制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%9C%B0%E5%9D%80%E5%88%B0%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%88%E5%88%86%E9%A1%B5%EF%BC%89"><span class="toc-text">线性地址到物理地址（分页）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IA-32%E4%B8%AD%E7%9A%84%E6%8E%A7%E5%88%B6%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">IA-32中的控制寄存器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E7%9B%AE%E5%BD%95%E9%A1%B9%E5%92%8C%E9%A1%B5%E8%A1%A8%E9%A1%B9%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-text">页目录项和页表项的格式</span></a></li></ol></li></ol>
    </div>
</div>



<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>




	</div>
	


<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
            

<article class="read-next-card" style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)">
  <header class="read-next-card-header">
    <small class="read-next-card-header-sitetitle">— Serial —</small>
    <h3 class="read-next-card-header-title">Recent Posts</h3>
  </header>
  <div class="read-next-divider">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"></path>
    </svg>
  </div>
  <div class="read-next-card-content">
    <ul>
      
      
      
      <li>
        <a href="/2021/06/24/Logging/">Logging</a>
      </li>
      
      
      
      <li>
        <a href="/2021/06/13/MIPS%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B/">MIPS汇编语言编程</a>
      </li>
      
      
      
      <li>
        <a href="/2021/06/13/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/">数据链路层</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
  <footer class="read-next-card-footer">
    <a href="/archives">  MORE  → </a>
  </footer>
</article>

            
            
            

<article class="read-next-card" style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)">
    <header class="read-next-card-header tagcloud-card">
        <h3 class="read-next-card-header-title">Categories</h3>
    </header>
    <div class="read-next-card-content">
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Bellman-Ford-SPFA/">Bellman-Ford &amp; SPFA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DFS/">DFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Dijkstra/">Dijkstra</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Floyd/">Floyd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HDL/">HDL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/KM/">KM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kruskal/">Kruskal</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LaTex/">LaTex</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode/">LeetCode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NEMU/">NEMU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Prim/">Prim</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/STL/">STL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tarjan/">Tarjan</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Trie/">Trie</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linear-algebra/">linear algebra</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E5%90%91%E6%98%9F%E5%92%8C%E9%93%BE%E5%BC%8F%E5%89%8D%E5%90%91%E6%98%9F/">前向星和链式前向星</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">动态规划</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%95%E8%B0%83%E6%A0%88/">单调栈</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/">单调队列</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%BE%E8%AE%BA/">图论</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97/">并行计算</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%A0%E9%87%8F%E7%BD%91%E7%BB%9C/">张量网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91%E4%B8%8E%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F/">数字逻辑与数字系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/">树状数组</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BA%BF%E6%AE%B5%E6%A0%91/">线段树</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%B0%E5%BD%95/">记录</a></li></ul>
    </div>
</article>


            
            
            

<article class="read-next-card" style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)">
	<header class="read-next-card-header tagcloud-card">
		<h3 class="read-next-card-header-title">Tag Cloud</h3>
	</header>
	<div class="read-next-card-content-ext">
		<a href="/tags/AVL%E6%A0%91/" style="font-size: 14px;">AVL树</a> <a href="/tags/Computer-Networking/" style="font-size: 14px;">Computer Networking</a> <a href="/tags/DataBase/" style="font-size: 14px;">DataBase</a> <a href="/tags/Database/" style="font-size: 16px;">Database</a> <a href="/tags/ICS-Experiments/" style="font-size: 14px;">ICS Experiments</a> <a href="/tags/Java/" style="font-size: 18px;">Java</a> <a href="/tags/LaTex/" style="font-size: 14px;">LaTex</a> <a href="/tags/LeetCode/" style="font-size: 14px;">LeetCode</a> <a href="/tags/MATLAB/" style="font-size: 22px;">MATLAB</a> <a href="/tags/MIPS/" style="font-size: 14px;">MIPS</a> <a href="/tags/Questions/" style="font-size: 14px;">Questions</a> <a href="/tags/SystemVerilog/" style="font-size: 14px;">SystemVerilog</a> <a href="/tags/algorithm/" style="font-size: 14px;">algorithm</a> <a href="/tags/divide-and-conquer/" style="font-size: 14px;">divide-and-conquer</a> <a href="/tags/experience/" style="font-size: 18px;">experience</a> <a href="/tags/hdu/" style="font-size: 18px;">hdu</a> <a href="/tags/markdown/" style="font-size: 14px;">markdown</a> <a href="/tags/pthread/" style="font-size: 14px;">pthread</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/tensorflow/" style="font-size: 14px;">tensorflow</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size: 14px;">动态规划</a> <a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 14px;">哈希</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 14px;">工具</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 16px;">操作系统</a> <a href="/tags/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91/" style="font-size: 14px;">数字逻辑</a> <a href="/tags/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91%E4%B8%8E%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F/" style="font-size: 14px;">数字逻辑与数字系统</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 20px;">数据结构</a> <a href="/tags/%E6%9C%80%E5%A4%A7%E6%B5%81/" style="font-size: 14px;">最大流</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 16px;">机器学习</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 14px;">正则表达式</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 14px;">笔记</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 24px;">算法</a> <a href="/tags/%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/" style="font-size: 14px;">算法分析</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" style="font-size: 16px;">计算机组成原理</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 20px;">计算机网络</a>
	</div>
</article>

            
        </div>
    </div>
</aside>

	




<div id="search" class="search-overlay">
    <div class="search-form">
        
        <div class="search-overlay-logo">
        	<img src="https://i.loli.net/2021/07/05/Yf2EJr7egbH4sSc.png" alt="Serial">
        </div>
        
        <input id="local-search-input" class="search-input" type="text" name="search" placeholder="Search ...">
        <a class="search-overlay-close" href="#"></a>
    </div>
    <div id="local-search-result"></div>
</div>

<footer class="site-footer outer">
	<div class="site-footer-content inner">
		<div class="copyright">
			<a href="/" title="Serial">Serial © 2021</a>
			
				
			        <span hidden="true" id="/2020/12/26/IA-32-Linux%E4%B8%8B%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80-%E7%BA%BF%E6%80%A7%E5%9C%B0%E5%9D%80-%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80/" class="leancloud-visitors" data-flag-title="IA-32/Linux下逻辑地址-线性地址-物理地址">
			            <span>阅读量 </span>
			            <span class="leancloud-visitors-count">0</span>
			        </span>
	    		
    		
		</div>
		<nav class="site-footer-nav">
			
			<a href="https://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
			<a href="https://github.com/xzhih/hexo-theme-casper" title="Casper" target="_blank" rel="noopener">Casper</a>
		</nav>
	</div>
</footer>
	


<script>
    if(window.navigator && navigator.serviceWorker) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister()
            }
        })
    }
</script>


<script id="scriptLoad" src="/js/allinone.min.js" async=""></script>


<script>
    document.getElementById('scriptLoad').addEventListener('load', function () {
        
        
            var bLazy = new Blazy();
        

        
        

        
        
        
            searchFunc("/");
        
        
    })
</script>




<link rel="stylesheet" href="/photoswipe/photoswipe.css">


<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>


<script src="/photoswipe/photoswipe-ui-default.min.js"></script>





<script id="valineScript" src="//unpkg.com/valine/dist/Valine.min.js" async=""></script>
<script>
    document.getElementById('valineScript').addEventListener("load", function() {
        new Valine({
            el: '#comment' ,
            verify: false,
            notify: false,
            appId: '',
            appKey: '',
            placeholder: 'Just go go',
            pageSize: 10,
            avatar: 'mm',
            visitor: true
        })
    });
</script>







</body></html>